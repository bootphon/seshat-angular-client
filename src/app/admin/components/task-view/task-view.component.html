<div *ngIf="taskData">

  <h2>{{taskData.filename}}</h2>
  <table style="width:100%">
    <tr>
      <td>Assigned by:</td>
      <td>{{taskData.assigner.fullname}}</td>
    </tr>
    <tr>
      <td>Campaign:</td>
      <td>
        <a [routerLink]="['/admin', 'campaign', taskData.campaign.slug]">
          {{taskData.campaign.name}}
        </a>
      </td>
    </tr>
    <tr>
      <td>Created:</td>
      <td>{{taskData.creation_time}}</td>
    </tr>
    <tr>
      <td>Deadline</td>
      <td>{{taskData.deadline}}</td>
    </tr>
    <tr>
      <td>Status</td>
      <td>{{taskData.status}}</td>
    </tr>
    <tr>
      <td>Annotators</td>
      <td>{{taskData.annotators.join(", ")}}</td>
    </tr>
  </table>

  <button mat-raised-button color="accent"
          [matTooltip]="taskData.is_locked? 'Unlock the task' : 'Lock the task'"
          (click)="changeTaskLock()">
    <mat-icon>{{taskData.is_locked ? 'lock_open' : 'lock'}}</mat-icon>
  </button>

  <button mat-mini-fab color="warn"
          matTooltip="Delete the task"
          (click)="deleteTask()">
    <mat-icon>delete_forever</mat-icon>
  </button>

  <h3>Files</h3>

  <table mat-table [dataSource]="textgridDataSource" class="mat-elevation-z2">

    <!-- Checkbox Column -->
    <ng-container matColumnDef="select">
      <th mat-header-cell *matHeaderCellDef>
        <mat-checkbox (change)="$event ? masterToggle() : null"
                      [checked]="tgSelection.hasValue() && isAllSelected()"
                      [indeterminate]="tgSelection.hasValue() && !isAllSelected()">
        </mat-checkbox>
      </th>
      <td mat-cell *matCellDef="let textgrid">
        <mat-checkbox (click)="$event.stopPropagation()"
                      (change)="$event ? tgSelection.toggle(textgrid) : null"
                      [checked]="tgSelection.isSelected(textgrid)"
                      [disabled]="textgrid.is_done">
        </mat-checkbox>
      </td>
    </ng-container>

    <ng-container matColumnDef="download">
      <th mat-header-cell *matHeaderCellDef>Download</th>
      <td mat-cell *matCellDef="let textgrid" (click)="$event.stopPropagation()">
        <button *ngIf="textgrid.is_done" mat-mini-fab color="primary"
                (click)="downloadTaskTextGrid(textgrid)">
          <mat-icon>get_app</mat-icon>
        </button>
      </td>
    </ng-container>

    <ng-container matColumnDef="delete">
      <th mat-header-cell *matHeaderCellDef>Delete</th>
      <td mat-cell *matCellDef="let textgrid" (click)="$event.stopPropagation()">
        <button *ngIf="textgrid.is_done" mat-mini-fab color="warn"
                (click)="deleteTaskTextGrid(textgrid)">
          <mat-icon>delete</mat-icon>
        </button>
      </td>
    </ng-container>

    <ng-container matColumnDef="name">
      <th mat-header-cell *matHeaderCellDef> Filename.</th>
      <td mat-cell *matCellDef="let textgrid"> {{textgrid.name}} </td>
    </ng-container>

    <ng-container matColumnDef="is_done">
      <th mat-header-cell *matHeaderCellDef> Is done</th>
      <td mat-cell *matCellDef="let textgrid"> {{textgrid.is_done}} </td>
    </ng-container>

    <ng-container matColumnDef="created">
      <th mat-header-cell *matHeaderCellDef> Creation</th>
      <td mat-cell *matCellDef="let textgrid">
        {{textgrid.is_done ? textgrid.creation : null}}
      </td>
    </ng-container>

    <ng-container matColumnDef="creator">
      <th mat-header-cell *matHeaderCellDef> Creators</th>
      <td mat-cell *matCellDef="let textgrid">
        {{textgrid.is_done ? textgrid.creators.join(', ') : null}}
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"
        (click)="tgSelection.toggle(row)">
    </tr>
  </table>

  <button mat-raised-button (click)="downloadTextGrids()">
    <mat-icon>save_alt</mat-icon>
    Download selected textgrids
  </button>

  <h3>Discussion</h3>
  <seshat-comments [taskID]="taskData.id"></seshat-comments>

</div>
