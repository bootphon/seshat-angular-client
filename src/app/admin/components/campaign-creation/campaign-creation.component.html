<div class="container p-5">
  <div class="row">
    <div class="col-12 mb-2">
      <h3>Create a new campaign</h3>
    </div>

    <div class="col-6">
      <mat-form-field appearance="standard" class="w-100">
        <mat-label>Name</mat-label>
        <input matInput required placeholder="" [(ngModel)]="campaignCreation.name">
      </mat-form-field>
    </div>

    <div class="col-6">
      <mat-form-field appearance="standard" class="w-100">
        <mat-label>Campaign Corpus</mat-label>
        <mat-select [(ngModel)]="chosenCorpora" required>
          <mat-option>&#45;&#45;</mat-option>
          <div *ngIf="availableCorpora; then options"></div>
          <ng-template #options>
            <mat-optgroup label="Folders">
              <mat-option *ngFor="let corpora of availableCorpora.folders_corpora"
                          [value]="{corporaType: 'folder', corporaName: corpora}">
                {{corpora}}
              </mat-option>
            </mat-optgroup>
            <mat-optgroup label="CSV">
              <mat-option *ngFor="let corpora of availableCorpora.csv_corpora"
                          [value]="{corporaType: 'csv', corporaName: corpora}">
                {{corpora}}
              </mat-option>
            </mat-optgroup>
          </ng-template>
        </mat-select>
      </mat-form-field>
    </div>

    <div class="col-12">
      <mat-form-field appearance="standard" class="w-100">
        <mat-label>Description</mat-label>
        <textarea matInput required cdkAutosizeMaxRows="5"
                  [(ngModel)]="campaignCreation.description"></textarea>
      </mat-form-field>
    </div>
  </div>

  <div class="row m-0 p3">
      <table class="w-100 mx-auto campaign-creation-buttons" cellpadding="13.5">
        <tr>
          <td><h4>Serve audio files to annotators</h4></td>
          <td style="width: 50px;">
              <mat-slide-toggle
              matTooltip="Annotators will have access via the interface to the audio file they're supposed to annotate"
              labelPosition="before"
              [(ngModel)]="campaignCreation.enable_audio_dl"
              appearance="standard"
              class="d-flex">
            </mat-slide-toggle>
          </td>
        </tr>
      </table>
      <div class="mat-elevation-z2">
        <mat-slide-toggle
          labelPosition="before"
          matTooltip="Enable checking rules on the campaign's textgrid to enforce an annotation standard"
          [(ngModel)]="campaignCreation.check_textgrids">
          Enable TextGrid checking
        </mat-slide-toggle>
        <div *ngIf="campaignCreation.check_textgrids">

          <div *ngFor="let tierSpecs of campaignCreation.checking_scheme">
            <div class="tier-specs-body">
              <mat-form-field>
                <mat-label>Tier Name</mat-label>
                <input matInput [(ngModel)]="tierSpecs.name">
              </mat-form-field>

              <mat-form-field >
                <mat-label>Select a validation option</mat-label>
                <mat-select [(value)]="tierSpecs.content_type">
                  <mat-option value="NONE">None</mat-option>
                  <mat-option value="CATEGORICAL">Categorical</mat-option>
                  <mat-option value="PARSED">Parsed</mat-option>
                </mat-select>
              </mat-form-field>

              <mat-form-field *ngIf="tierSpecs.content_type === 'CATEGORICAL'">
                <mat-chip-list #chipList aria-label="Fruit selection">
                  <mat-chip *ngFor="let category of tierSpecs.categories"
                            removable="true" (removed)="removeCategory(tierSpecs, category)">
                    {{category}}
                    <mat-icon matChipRemove>cancel</mat-icon>
                  </mat-chip>
                  <input placeholder="New category"
                         [matChipInputFor]="chipList"
                         [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                         matChipInputAddOnBlur="true"
                         (matChipInputTokenEnd)="addCategory(tierSpecs, $event)">
                </mat-chip-list>
              </mat-form-field>

              <mat-form-field *ngIf="tierSpecs.validate_tier && tierSpecs.content_type === 'PARSED'">
                <mat-select [(ngModel)]="tierSpecs.parser_name" placeholder="Select">
                  <mat-option value="option">Option</mat-option>
                </mat-select>
              </mat-form-field>

              <mat-slide-toggle
                matTooltip="This tier's (and its intervals) can contain no annotation"
                labelPosition="before"
                [(ngModel)]="tierSpecs.allow_empty">
                Allow Empty
              </mat-slide-toggle>

            </div>

            <div class="tier-specs-footer">
              <button mat-flat-button matTooltip="Duplicate this Tier" (click)="duplicateTier(tierSpecs)">
                <mat-icon>file_copy</mat-icon>
              </button>
              <button mat-flat-button matTooltip="Add a new tier" (click)="deleteTier(tierSpecs)">
                <mat-icon>delete</mat-icon>
              </button>
              <mat-slide-toggle
                matTooltip="This tier is required for the textgrid to be valid"
                labelPosition="before"
                [(ngModel)]="tierSpecs.required">
                Required
              </mat-slide-toggle>
            </div>

          </div>

          <button mat-fab matTooltip="Add a new tier" (click)="addTier()"><mat-icon>add</mat-icon></button>
        </div>

      </div>
  </div>

  <button mat-raised-button color="primary" (click)="createCampaign()">Create campaign</button>

</div>
